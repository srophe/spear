<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SPARQL Dropdown Test</title>
  <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'IM Fell English', serif;
      background: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
      color: #3b2f2f;
      padding: 2rem;
      line-height: 1.6;
      background-color: #fdf6e3;
    }

    h1 {
      font-size: 2.2rem;
      text-align: center;
      margin-bottom: 2rem;
      text-shadow: 1px 1px #d6c8a2;
    }

    label {
      font-weight: bold;
      margin-top: 1rem;
    }

    select {
      font-family: 'IM Fell English', serif;
      background-color: #f5f1de;
      border: 1px solid #a3987e;
      padding: 0.5rem;
      font-size: 1rem;
      width: 100%;
      max-width: 400px;
      box-shadow: 2px 2px 3px #d6c8a2;
    }

    #result, #factoidResults {
      margin-top: 1.5rem;
      padding: 1rem;
      background-color: #fcf8e3;
      border: 1px solid #c1b49a;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    ul {
      list-style-type: none;
      padding-left: 0;
    }

    li {
      margin-bottom: 1rem;
    }

    a {
      color: #6b4e15;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
      color: #3b2f2f;
    }

    em, small {
      color: #5c4a2f;
    }

    button {
      display: none; /* Hides the manual trigger */
    }
  </style>
</head>
<body>
  <h1>Browse SPARQL Results</h1>

  <label for="queryType">Choose a query type:</label>

<select id="queryType">
  <option value="event">Event Keywords</option>
  <option value="ethnicity">Ethnicities</option>
  <option value="place">Places</option>
  <option value="fieldOfStudy">Education Fields of Study</option> 
</select>


  <label for="resultDropdown">Select a result:</label>
  <select id="resultDropdown"></select>

  <div id="result">Results</div>
  <button id="loadFactoidsBtn">Load Related Factoids</button>
  <div id="factoidResults" style="margin-top: 1rem;"></div>

  <script type="module">
    import {
      getEventKeywords,
      getEthnicityOptions,
      getPlaceOptions,
      getEducationFieldsOfStudy,
      populateDropdown,
      fetchPeopleRelatedToKeyword
    } from './menuqueries.js';
    import { fetchFactoidsByType, getAllFactoids,getAllPersonFactoids,getFactoidsForEthnicity,getFactoidsForPlace,getFactoidsForFieldOfStudy } from './factoidsqueries.js';

    const queryTypeSelect = document.getElementById('queryType');
    const resultDropdown = document.getElementById('resultDropdown');
    const resultDisplay = document.getElementById('result');

  const loadQuery = (type) => {
    if (type === 'event') {
      populateDropdown(getEventKeywords(), 'resultDropdown', 'keyword', 'keyword');
    } else if (type === 'ethnicity') {
      populateDropdown(getEthnicityOptions(), 'resultDropdown', 'ethnicity', 'ethnicity');
    } else if (type === 'place') {
      populateDropdown(getPlaceOptions(), 'resultDropdown', 'label', 'place');
    } else if (type === 'fieldOfStudy') {
      populateDropdown(getEducationFieldsOfStudy(), 'resultDropdown', 'label', 'subject');
    }
  };


    // Load default query on page load
    loadQuery(queryTypeSelect.value);

    // When query type changes
    queryTypeSelect.addEventListener('change', () => {
      loadQuery(queryTypeSelect.value);
    });

    // Show selected URI
    resultDropdown.addEventListener('change', () => {
      resultDisplay.textContent = `Selected URI: ${resultDropdown.value}`;
    });
  resultDropdown.addEventListener('change', async () => {
    const selectedValue = resultDropdown.value;
    const type = queryTypeSelect.value;
    const relatedPeople = await fetchPeopleRelatedToKeyword(selectedValue, type);

    if (relatedPeople.length === 0) {
      resultDisplay.innerHTML = `<p>No associated persons found.</p>`;
    } else {
      resultDisplay.innerHTML = `
        <p><strong>Related Person URIs:</strong></p>
        <ul>
          ${relatedPeople
            .map(p => `
              <li>
                <a href="${p.person}" target="_blank">${p.label || p.person}</a>
                ${p.gender ? ` â€“ ${p.gender}` : ""}
                ${p.description ? `<br/><em>${p.description}</em>` : ""}
              </li>
            `)
            .join('')}
        </ul>
      `;
    }
  });

const factoidButton = document.getElementById('loadFactoidsBtn');
const factoidDisplay = document.getElementById('factoidResults');

factoidButton.addEventListener('click', async () => {
  const selectedUri = resultDropdown.value;
  const type = queryTypeSelect.value;

  const factoids = await fetchFactoidsByType(selectedUri, type);
  if (!factoids.length) {
    factoidDisplay.innerHTML = "<em>No factoids found for this selection.</em>";
    return;
  }

  factoidDisplay.innerHTML = `
    <h3>Related Factoids:</h3>
    <ul>
      ${factoids.map(f => `<li><a href="${f.uri}" target="_blank">${f.uri}</a><br><small>${f.description}</small></li>`).join('')}
    </ul>
  `;
});

  </script>
</body>
</html>
